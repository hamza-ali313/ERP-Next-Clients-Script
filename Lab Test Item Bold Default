frappe.ui.form.on('Lab Test', {
    template: function (frm) {
        if (!frm.doc.template) return;

        frappe.call({
            method: 'frappe.client.get',
            args: {
                doctype: 'Lab Test Template',
                name: frm.doc.template
            },
            callback: function (r) {
                if (!r.message) return;

                const template_rows = r.message.normal_test_templates || [];
                const test_items = frm.doc.normal_test_items || [];

                // Row-by-row copy
                test_items.forEach((item, index) => {
                    if (template_rows[index]) {
                        item.bold = template_rows[index].text_bold ? 1 : 0;
                    }
                });

                frm.refresh_field('normal_test_items');
            }
        });
    }
});
